#include "acir_format.hpp"
#include "barretenberg/plonk/proof_system/types/proof.hpp"
#include <gtest/gtest.h>
#include <vector>
#include "barretenberg/common/streams.hpp"

TEST(acir_format, test_acir_format)
{
    acir_format::acir_format constraint_system{
        .varnum = 4,
        .public_inputs = {},
        .fixed_base_scalar_mul_constraints = {},
        .logic_constraints = {},
        .range_constraints = {},
        .schnorr_constraints = {},
        .ecdsa_constraints = {},
        .sha256_constraints = {},
        .blake2s_constraints = {},
        .hash_to_field_constraints = {},
        .pedersen_constraints = {},
        .merkle_membership_constraints = {},
        .constraints = { poly_triple{
            .a = 1,
            .b = 2,
            .c = 3,
            .q_m = 0,
            .q_l = 1,
            .q_r = 1,
            .q_o = fr::neg_one(),
            .q_c = 0,
        } },
    };
    auto composer = acir_format::create_circuit_with_witness(constraint_system, { 0, 0, 0 });

    for (size_t i = 0; i < composer.num_selectors; i++) {
        std::cout << composer.selectors[i] << std::endl;
    }
    std::cout << composer.w_l << std::endl;
    std::cout << composer.w_o << std::endl;
    std::cout << composer.w_r << std::endl;
    std::cout << composer.w_4 << std::endl;

    auto prover = composer.create_prover();
    composer.circuit_proving_key->polynomial_store.print();
    std::cout << composer.circuit_proving_key->circuit_size << std::endl;
    auto proof = prover.construct_proof();

    std::cout << proof.proof_data << std::endl;
    // std::vector<uint8_t> in{14, 188, 41, 75, 108, 105, 243, 108, 160, 44, 100, 26, 193, 100, 31, 59, 167, 187, 242,
    // 230, 244, 24, 167, 230, 96, 169, 118, 238, 229, 192, 33, 154, 11, 230, 125, 113, 102, 167, 111, 26, 83, 217, 57,
    // 101, 2, 184, 59, 199, 136, 64, 200, 110, 168, 98, 135, 119, 179, 196, 21, 69, 212, 252, 207, 42, 39, 138, 237,
    // 34, 137, 160, 8, 237, 180, 12, 39, 156, 105, 106, 177, 191, 232, 144, 177, 6, 196, 51, 49, 139, 197, 188, 10, 18,
    // 250, 26, 10, 217, 19, 181, 48, 86, 26, 173, 249, 97, 176, 186, 197, 21, 42, 166, 42, 88, 86, 3, 73, 63, 6, 159,
    // 70, 110, 175, 170, 131, 85, 188, 228, 230, 223, 26, 24, 69, 139, 242, 8, 25, 121, 176, 200, 213, 173, 156, 110,
    // 90, 14, 26, 115, 214, 85, 100, 87, 230, 63, 247, 186, 194, 233, 114, 212, 27, 69, 1, 252, 63, 191, 185, 167, 209,
    // 72, 107, 29, 172, 78, 241, 0, 119, 120, 193, 135, 13, 205, 82, 108, 106, 195, 169, 123, 37, 93, 169, 117, 252,
    // 254, 4, 27, 174, 168, 66, 231, 218, 17, 247, 96, 106, 117, 65, 95, 163, 64, 69, 77, 120, 231, 188, 139, 228, 157,
    // 71, 47, 78, 12, 69, 216, 193, 226, 24, 30, 100, 164, 37, 7, 226, 124, 237, 144, 147, 83, 46, 179, 14, 240, 186,
    // 124, 249, 185, 42, 127, 93, 141, 17, 143, 175, 216, 115, 81, 137, 223, 39, 165, 105, 18, 48, 118, 163, 204, 186,
    // 209, 151, 58, 72, 122, 52, 140, 65, 2, 159, 75, 205, 253, 135, 155, 212, 246, 218, 67, 33, 183, 36, 85, 18, 243,
    // 155, 36, 145, 48, 21, 55, 26, 3, 142, 156, 30, 98, 217, 148, 48, 69, 35, 103, 11, 113, 62, 108, 253, 45, 193,
    // 184, 141, 117, 233, 237, 6, 62, 101, 180, 135, 42, 97, 147, 71, 167, 21, 216, 244, 5, 254, 26, 134, 147, 44, 97,
    // 69, 198, 7, 141, 80, 41, 108, 79, 132, 153, 208, 16, 28, 51, 9, 239, 154, 4, 227, 207, 50, 228, 112, 131, 73,
    // 177, 172, 180, 121, 96, 115, 234, 0, 132, 100, 5, 214, 97, 81, 67, 16, 243, 152, 35, 28, 125, 61, 113, 170, 117,
    // 3, 120, 133, 82, 94, 215, 138, 164, 220, 33, 44, 16, 176, 181, 66, 84, 181, 246, 16, 117, 205, 157, 100, 237,
    // 124, 3, 10, 232, 217, 63, 201, 207, 156, 1, 130, 170, 185, 252, 7, 103, 12, 79, 242, 20, 220, 82, 46, 201, 205,
    // 42, 66, 196, 13, 54, 69, 207, 21, 125, 44, 146, 14, 14, 167, 223, 122, 98, 25, 62, 158, 155, 45, 154, 186, 14,
    // 244, 9, 231, 109, 44, 50, 174, 9, 143, 27, 54, 188, 86, 27, 5, 191, 1, 221, 84, 254, 117, 53, 64, 180, 193, 11,
    // 58, 102, 241, 62, 104, 41, 101, 50, 137, 48, 96, 214, 242, 227, 240, 147, 1, 194, 133, 202, 237, 139, 21, 223,
    // 222, 121, 30, 66, 136, 159, 154, 33, 162, 15, 127, 165, 205, 144, 80, 202, 252, 144, 177, 219, 233, 21, 70, 47,
    // 183, 199, 239, 111, 44, 79, 46, 118, 54, 176, 225, 99, 117, 142, 241, 34, 130, 180, 121, 4, 165, 193, 68, 70, 64,
    // 76, 194, 156, 15, 138, 93, 154, 51, 181, 120, 179, 1, 158, 5, 98, 55, 244, 71, 103, 142, 118, 154, 176, 204, 138,
    // 128, 20, 179, 189, 37, 159, 185, 15, 160, 223, 209, 207, 168, 68, 134, 62, 44, 114, 22, 18, 23, 39, 124, 90, 19,
    // 108, 112, 50, 91, 38, 211, 176, 91, 169, 19, 99, 152, 133, 80, 126, 64, 240, 46, 37, 186, 224, 75, 19, 30, 39,
    // 91, 159, 43, 42, 254, 206, 18, 7, 170, 20, 238, 179, 133, 143, 71, 0, 49, 32, 195, 47, 12, 34, 119, 101, 201,
    // 191, 1, 82, 58, 245, 92, 81, 252, 144, 12, 181, 224, 229, 93, 20, 212, 202, 62, 187, 67, 66, 6, 33, 229, 46, 63,
    // 55, 58, 52, 181, 131, 51, 19, 42, 27, 31, 74, 57, 163, 175, 204, 39, 76, 97, 94, 85, 82, 162, 97, 61, 232, 92,
    // 81, 127, 140, 19, 216, 226, 30, 218, 235, 215, 59, 48, 151, 201, 131, 201, 40, 39, 158, 56, 252, 21, 236, 43,
    // 244, 77, 161, 16, 162, 189, 142, 40, 130, 0, 67, 91, 15, 84, 201, 251, 26, 149, 92, 77, 247, 119, 140, 163, 68,
    // 123, 125, 44, 160, 21, 236, 43, 244, 77, 161, 16, 162, 189, 142, 40, 130, 0, 67, 91, 15, 182, 240, 37, 177, 163,
    // 18, 5, 14, 117, 16, 174, 32, 148, 62, 91, 113, 13, 155, 159, 37, 213, 70, 253, 199, 48, 39, 110, 84, 156, 11, 92,
    // 113, 80, 103, 124, 159, 90, 186, 26, 46, 177, 219, 58, 54, 77, 120, 107, 114, 23, 167, 190, 104, 201, 2, 34, 15,
    // 128, 198, 170, 58, 198, 255, 43, 83, 205, 188, 83, 40, 144, 44, 58, 148, 128, 231, 62, 108, 210, 2, 3, 120, 38,
    // 7, 62, 17, 92, 112, 103, 186, 160, 3, 233, 97, 105, 180, 212, 39, 82, 28, 211, 181, 166, 174, 227, 142, 186, 140,
    // 172, 16, 22, 137, 53, 170, 46, 172, 66, 52, 39, 33, 128, 49, 137, 145, 94, 251, 201, 133, 148, 239, 70, 168, 127,
    // 55, 154, 151, 105, 15, 156, 150, 55, 129, 159, 168, 228, 246, 24, 52, 203, 225, 193, 149, 133, 44, 75, 131, 87,
    // 25, 203, 208, 181, 208, 245, 182, 71, 24, 133, 8, 146, 179, 98, 43, 73, 83, 217, 118, 188, 106, 12, 28, 41, 11,
    // 193, 115, 59, 80, 111, 254, 121, 11, 237, 72, 97, 84, 187, 238, 5, 132, 114, 161, 133, 160, 219, 231, 46, 91, 45,
    // 181, 49, 38, 36, 75, 171, 156, 225, 15, 86, 77, 220, 203, 103, 168, 162, 249, 3, 224, 238, 107, 166, 180, 103,
    // 82, 99, 126, 189, 157, 218, 155, 68, 62, 116, 189, 24, 51, 8, 198, 224, 237, 12, 114, 1, 70, 137, 154, 196, 112,
    // 175, 100, 180, 163, 101, 32, 84, 235, 86, 108, 55, 89, 191, 162, 152, 124, 233, 121, 11, 144, 222, 173, 169, 136,
    // 80, 237, 239, 126, 153, 171, 239, 214, 221, 67, 213, 6, 243, 140, 173, 226, 105, 201, 37, 116, 173, 37, 103, 58,
    // 75, 37, 12, 29, 236, 38, 162, 27, 180, 10, 186, 59, 70, 138, 244, 168, 103, 192, 253, 0, 231, 124, 162, 190, 193,
    // 232, 6, 184, 184, 12, 110, 175, 4, 23, 24, 54, 142, 252, 162, 61, 253, 230, 149, 192, 36, 152, 211, 48, 188, 61,
    // 54, 201, 41, 16, 181, 37, 206, 250, 140, 252, 211, 5, 26, 112, 143, 91, 36, 79, 49, 210, 162, 96, 71, 194, 113,
    // 69, 2, 166, 177, 185, 16, 185, 112, 145, 106, 164, 199, 140, 220, 13, 19, 64, 237, 253, 198, 50, 26, 159, 43,
    // 228, 204, 8, 110, 94, 1, 158, 157, 154, 118, 148, 125, 190, 65, 175, 132, 79, 73, 148, 6, 112, 101, 124, 152,
    // 119, 200, 180, 166, 191, 147, 125, 33, 22, 253, 111, 136, 213, 118, 163, 209, 194, 40, 66, 115, 176, 93, 147,
    // 179, 150, 222, 98, 218, 46, 77, 19, 203, 55, 80, 74, 92, 204, 137, 110, 39, 236, 84, 137, 141, 20, 106, 30, 169,
    // 115, 127, 46, 93, 129, 72, 19, 176, 102, 107, 118, 102, 31, 148, 76, 229, 194, 160, 101, 42, 234, 88, 76, 12, 10,
    // 3, 52, 130, 98, 89, 199, 225, 48, 165, 84, 63, 249, 129, 60, 167, 141, 32, 217, 67, 54, 16, 185, 177, 163, 118,
    // 31, 248, 160, 100, 47, 44, 198, 255, 89, 37, 31, 12, 211, 215, 168, 95, 63, 26, 31, 60, 170, 46, 76, 174, 42, 48,
    // 113, 154, 251, 101, 205, 168, 22, 111, 46, 130, 230, 42, 236, 115, 102, 28, 237, 115, 145, 214, 192, 66, 247, 17,
    // 104, 60, 181, 119, 192, 237, 63, 118, 93, 205, 133, 12, 226, 80, 18, 60, 26, 167, 190, 4, 18, 29, 175, 155, 25,
    // 68, 86, 33, 232, 53, 249, 1, 137, 111, 166, 132, 217, 143, 115, 148, 130, 18, 169, 204, 84, 158, 34, 103, 10, 97,
    // 162, 44, 188, 192, 78, 120, 199, 136, 31, 35, 164, 251, 122, 8, 225, 70, 195, 21, 182, 132, 80, 142, 134, 109, 9,
    // 33, 73, 119, 101, 1, 94, 227, 165, 3, 52, 193, 42, 230, 97, 167, 127, 127, 113, 141, 167, 124, 170, 150, 15, 107,
    // 7, 232, 85, 54, 53, 254, 32, 108, 242, 70, 145, 139, 150, 91, 220, 14, 154, 114, 62, 131, 91, 119, 254, 116, 152,
    // 64, 52, 162, 65, 15, 192, 142, 102, 113, 197, 110, 89, 160, 29, 238, 205, 202, 181, 156, 27, 111, 246};

    // plonk::proof proof {
    //     .proof_data = in,
    // };

    auto verifier = composer.create_verifier();

    EXPECT_EQ(verifier.verify_proof(proof), true);
}
